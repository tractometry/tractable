<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting Generalized Additive Models (GAMs) • tractable</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting Generalized Additive Models (GAMs)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tractable</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/changing-k.html">Changing model flexibility</a></li>
    <li><a class="dropdown-item" href="../articles/tractable-single-bundle.html">Fitting Generalized Additive Models (GAMs)</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yeatmanlab/tractable/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fitting Generalized Additive Models (GAMs)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yeatmanlab/tractable/blob/main/vignettes/tractable-single-bundle.Rmd" class="external-link"><code>vignettes/tractable-single-bundle.Rmd</code></a></small>
      <div class="d-none name"><code>tractable-single-bundle.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates the use of GAMs for statistical analysis
of tract profile data. The data we will use here contains tract profiles
from diffusion MRI measurements in a group of patients with Amyotrophic
Lateral Sclerosis (ALS) and a group of matched controls <span class="citation">(Sarica et al. 2017)</span>.</p>
<p>We start by loading the <code>tractable</code> library:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yeatmanlab/tractable" class="external-link">tractable</a></span><span class="op">)</span></span></code></pre></div>
<p>Next, we will use a function that is included in
<code>tractable</code> to read this dataset directly into memory.
Importantly, both the group (“ALS” or “CTRL”) and the subject identifier
(“subjectID”) need to be factors for subsequent analysis to work
properly.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sarica</span> <span class="op">&lt;-</span> <span class="fu">tractable</span><span class="fu">::</span><span class="fu"><a href="../reference/read_afq_sarica.html">read_afq_sarica</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sarica</span><span class="op">$</span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sarica</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span>
<span><span class="va">sarica</span><span class="op">$</span><span class="va">subjectID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sarica</span><span class="op">$</span><span class="va">subjectID</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>First, let’s visualize the data. We use the
<code>plot_tract_profiles</code> function, selecting to view both
fractional anisotropy (FA) and mean diffusivity profiles in two tracts:
the right corticospinal tract (CST) and the right superior longitudinal
fasciculus (SLF), which are identified in the “tractID” column of this
dataset.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tractable</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_tract_profiles.html">plot_tract_profiles</a></span><span class="op">(</span></span>
<span>  df          <span class="op">=</span> <span class="va">sarica</span>,</span>
<span>  group_col   <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  n_groups    <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  metrics     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fa"</span>, <span class="st">"md"</span><span class="op">)</span>,</span>
<span>  bundles     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Right Corticospinal"</span>, <span class="st">"Right SLF"</span><span class="op">)</span>,</span>
<span>  bundles_col <span class="op">=</span> <span class="st">"tractID"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 81 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_summary()`).</span></span>
<span><span class="co">#&gt; Removed 81 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_summary()`).</span></span>
<span><span class="co">#&gt; $fa</span></span>
<span><span class="co">#&gt; Warning: Removed 81 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_summary()`).</span></span>
<span><span class="co">#&gt; Removed 81 rows containing non-finite outside the scale range</span></span>
<span><span class="co">#&gt; (`stat_summary()`).</span></span></code></pre></div>
<p><img src="tractable-single-bundle_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $md</span></span></code></pre>
<p><img src="tractable-single-bundle_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<p>We can already see that ALS has a profound effect on the tract
profiles of the CST, but does not affect SLF as much. We will use GAMs
in order to quantify this in statistical terms. We start by fitting a
GAM model to the data from the CST. Using the
<code>tractable_single_bundle</code> function, we select the Right CST
data, and focus here only on FA. We use “group” and “age” as relevant
covariates. Comparing group as a main effect, that will also be used to
fit separate smooth functions for each category of subjects. The
<code>mgcv</code> GAM functions use a parameter <code>k</code> to
determine how many spline functions to use in fitting the smooth change
of FA over the length of the tract. We use an automated strategy to find
<code>k</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gam_fit_cst</span> <span class="op">&lt;-</span> <span class="fu">tractable</span><span class="fu">::</span><span class="fu"><a href="../reference/tractable_single_bundle.html">tractable_single_bundle</a></span><span class="op">(</span></span>
<span>  df_afq         <span class="op">=</span> <span class="va">sarica</span>,</span>
<span>  tract          <span class="op">=</span> <span class="st">"Right Corticospinal"</span>,</span>
<span>  participant_id <span class="op">=</span> <span class="st">"subjectID"</span>,</span>
<span>  group_by       <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  covariates     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"group"</span><span class="op">)</span>,</span>
<span>  dwi_metric     <span class="op">=</span> <span class="st">"fa"</span>,</span>
<span>  k              <span class="op">=</span> <span class="st">"auto"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Examining the summary of the resulting GAM fit object shows us that
the <code>k=16</code> is sufficiently large to describe the spatial
variation of tract profile data. In addition, we see that there is a
statistically significant effect of group (with a p-value of 4.66e-10)
and no statistically significant effect of age (p=0.2748).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gam_fit_cst</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: Beta regression(113.72) </span></span>
<span><span class="co">#&gt; Link function: logit </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; fa ~ age + group + s(nodeID, by = group, k = 16) + s(subjectID, </span></span>
<span><span class="co">#&gt;     bs = "re")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) -0.148763   0.080666  -1.844   0.0652 .  </span></span>
<span><span class="co">#&gt; age          0.001425   0.001305   1.092   0.2748    </span></span>
<span><span class="co">#&gt; groupCTRL    0.138659   0.022209   6.243 4.66e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;                       edf Ref.df      F p-value    </span></span>
<span><span class="co">#&gt; s(nodeID):groupALS  14.65  14.98 512.68  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(nodeID):groupCTRL 14.60  14.97 569.00  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(subjectID)        42.22  45.00  15.13  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; R-sq.(adj) =  0.793   Deviance explained = 80.1%</span></span>
<span><span class="co">#&gt; fREML = 6902.9  Scale est. = 1         n = 4734</span></span></code></pre></div>
<p>Running the same analysis on the data from SLF, we see that there is
no significant difference between the groups in this bundle, indicating
that the effect observed in CST is rather specific to this bundle.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gam_fit_slf</span> <span class="op">&lt;-</span> <span class="fu">tractable</span><span class="fu">::</span><span class="fu"><a href="../reference/tractable_single_bundle.html">tractable_single_bundle</a></span><span class="op">(</span></span>
<span>  df_afq         <span class="op">=</span> <span class="va">sarica</span>,</span>
<span>  tract          <span class="op">=</span> <span class="st">"Right SLF"</span>,</span>
<span>  participant_id <span class="op">=</span> <span class="st">"subjectID"</span>,</span>
<span>  group_by       <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  covariates     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>,<span class="st">"group"</span><span class="op">)</span>,</span>
<span>  dwi_metric     <span class="op">=</span> <span class="st">"fa"</span>,</span>
<span>  k              <span class="op">=</span> <span class="st">"auto"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gam_fit_slf</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: Beta regression(138.594) </span></span>
<span><span class="co">#&gt; Link function: logit </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; fa ~ age + group + s(nodeID, by = group, k = 16) + s(subjectID, </span></span>
<span><span class="co">#&gt;     bs = "re")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)   </span></span>
<span><span class="co">#&gt; (Intercept) -0.3253345  0.1247686  -2.608  0.00915 **</span></span>
<span><span class="co">#&gt; age         -0.0004088  0.0020187  -0.203  0.83953   </span></span>
<span><span class="co">#&gt; groupCTRL    0.0225944  0.0343532   0.658  0.51076   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;                       edf Ref.df      F p-value    </span></span>
<span><span class="co">#&gt; s(nodeID):groupALS  14.59  14.97 379.87  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(nodeID):groupCTRL 14.61  14.97 379.60  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(subjectID)        44.04  45.00  45.53  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; R-sq.(adj) =  0.744   Deviance explained = 76.6%</span></span>
<span><span class="co">#&gt; fREML = 7006.8  Scale est. = 1         n = 4785</span></span></code></pre></div>
<p>This is in line with other work that we have conducted with this
dataset using other methods <span class="citation">(Richie-Halford et
al. 2021)</span>.</p>
<p>If you are interested in exploring the ALS dataset even more, you can
also see this data in an AFQ-Browser <a href="yeatmanlab.github.io/Sarica_2017/">here</a> <span class="citation">(Yeatman et al. 2018)</span>.</p>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Richie-Halford2021SGL" class="csl-entry">
Richie-Halford, Adam, Jason D Yeatman, Noah Simon, and Ariel Rokem.
2021. <span>“Multidimensional Analysis and Detection of Informative
Features in Human Brain White Matter.”</span> <em>PLoS Comput.
Biol.</em> 17 (6): e1009136.
</div>
<div id="ref-Sarica2017" class="csl-entry">
Sarica, Alessia, Antonio Cerasa, Paola Valentino, Jason Yeatman, Maria
Trotta, Stefania Barone, Alfredo Granata, et al. 2017. <span>“The
Corticospinal Tract Profile in Amyotrophic Lateral Sclerosis.”</span>
<em>Hum. Brain Mapp.</em> 38 (2): 727–39.
</div>
<div id="ref-Yeatman2018AFQB" class="csl-entry">
Yeatman, Jason D, Adam Richie-Halford, Josh K Smith, Anisha Keshavan,
and Ariel Rokem. 2018. <span>“A Browser-Based Tool for Visualization and
Analysis of Diffusion <span>MRI</span> Data.”</span> <em>Nat.
Commun.</em> 9 (1): 940.
</div>
</div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adam Richie-Halford, Kelly Chang, Teresa Gomez, McKenzie Hagen, Ariel Rokem.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
