<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting Generalized Additive Models (GAMs) • tractable</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting Generalized Additive Models (GAMs)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tractable</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/changing-k.html">Changing model flexibility</a></li>
    <li><a class="dropdown-item" href="../articles/tractable-autocorrelations.html">Including Autocorrelation Effects in GAMs</a></li>
    <li><a class="dropdown-item" href="../articles/tractable-single-tract.html">Fitting Generalized Additive Models (GAMs)</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tractometry/tractable/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fitting Generalized Additive Models (GAMs)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tractometry/tractable/blob/0.3.0/vignettes/tractable-single-tract.Rmd" class="external-link"><code>vignettes/tractable-single-tract.Rmd</code></a></small>
      <div class="d-none name"><code>tractable-single-tract.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates the use of GAMs for statistical analysis
of tract profile data. The data we will use here contains tract profiles
from diffusion MRI measurements in a group of patients with Amyotrophic
Lateral Sclerosis (ALS) and a group of matched controls <span class="citation">(Sarica et al. 2017)</span>.</p>
<p>We start by loading the <code>tractable</code> library:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tractometry/tractable" class="external-link">tractable</a></span><span class="op">)</span></span></code></pre></div>
<p>Next, we will use a function that is included in
<code>tractable</code> to read this dataset directly into memory.</p>
<p>Importantly, both the group (“ALS” or “CTRL”) and the subject
identifier (“subjectID”) need to be factors for subsequent analysis to
work properly.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_sarica</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_afq_sarica.html">read_afq_sarica</a></span><span class="op">(</span>na_omit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">df_sarica</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 93,377 × 8</span></span></span>
<span><span class="co">#&gt;    subjectID   tractID                 nodeID    fa    md   age group gender</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> subject_000 Left Thalamic Radiation      0 0.174 0.965    54 ALS   F     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> subject_000 Left Thalamic Radiation      1 0.227 0.912    54 ALS   F     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> subject_000 Left Thalamic Radiation      2 0.282 0.874    54 ALS   F     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> subject_000 Left Thalamic Radiation      3 0.318 0.851    54 ALS   F     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> subject_000 Left Thalamic Radiation      4 0.341 0.830    54 ALS   F     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> subject_000 Left Thalamic Radiation      5 0.353 0.812    54 ALS   F     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> subject_000 Left Thalamic Radiation      6 0.357 0.802    54 ALS   F     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> subject_000 Left Thalamic Radiation      7 0.357 0.795    54 ALS   F     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> subject_000 Left Thalamic Radiation      8 0.359 0.790    54 ALS   F     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> subject_000 Left Thalamic Radiation      9 0.371 0.784    54 ALS   F     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 93,367 more rows</span></span></span></code></pre></div>
<p>First, let’s visualize the data. We use the
<code>plot_tract_profiles</code> function, selecting to view both
fractional anisotropy (FA) and mean diffusivity profiles in two tracts:
the right corticospinal tract (CST) and the right superior longitudinal
fasciculus (SLF), which are identified in the “tractID” column of this
dataset.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_handles</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_tract_profiles.html">plot_tract_profiles</a></span><span class="op">(</span></span>
<span>  df          <span class="op">=</span> <span class="va">df_sarica</span>,</span>
<span>  y           <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fa"</span>, <span class="st">"md"</span><span class="op">)</span>,</span>
<span>  tracts      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Right Corticospinal"</span>, <span class="st">"Right SLF"</span><span class="op">)</span>,</span>
<span>  group_col   <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  save_figure <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_handles</span><span class="op">$</span><span class="va">fa</span></span></code></pre></div>
<p><img src="tractable-single-tract_files/figure-html/plot_fa-1.png" width="696" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_handles</span><span class="op">$</span><span class="va">md</span></span></code></pre></div>
<p><img src="tractable-single-tract_files/figure-html/plot_md-1.png" width="696" style="display: block; margin: auto;"></p>
<p>We can already see that ALS has a profound effect on the tract
profiles of the CST, but does not affect SLF as much. We will use GAMs
in order to quantify this in statistical terms. We start by fitting a
GAM model to the data from the CST. Using the
<code>tractable_single_tract</code> function, we select the Right CST
data, and focus here only on FA. We use “group” and “age” as relevant
covariates. Comparing group as a main effect, that will also be used to
fit separate smooth functions for each category of subjects. The
<code>mgcv</code> GAM functions use a parameter <code>k</code> to
determine how many spline functions to use in fitting the smooth change
of FA over the length of the tract. We use an automated strategy to find
<code>k</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cst_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tractable_single_tract.html">tractable_single_tract</a></span><span class="op">(</span></span>
<span>  df         <span class="op">=</span> <span class="va">df_sarica</span>,</span>
<span>  tract      <span class="op">=</span> <span class="st">"Right Corticospinal"</span>,</span>
<span>  target     <span class="op">=</span> <span class="st">"fa"</span>,</span>
<span>  regressors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"group"</span><span class="op">)</span>,</span>
<span>  node_group <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  k          <span class="op">=</span> <span class="st">"auto"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cst_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cst_fit</span><span class="op">)</span></span>
<span><span class="va">cst_summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: gaussian </span></span>
<span><span class="co">#&gt; Link function: identity </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; fa ~ age + group + s(nodeID, by = group, bs = "fs", k = 9) + </span></span>
<span><span class="co">#&gt;     s(subjectID, bs = "re")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 0.422545   0.056591    7.47  9.8e-14 ***</span></span>
<span><span class="co">#&gt; age         0.000858   0.000915    0.94    0.348    </span></span>
<span><span class="co">#&gt; groupCTRL   0.035936   0.015961    2.25    0.024 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;                       edf Ref.df     F p-value    </span></span>
<span><span class="co">#&gt; s(nodeID):groupALS   7.97      8 445.5  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(nodeID):groupCTRL  7.96      8 534.8  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(subjectID)        42.42     46  29.9  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; R-sq.(adj) =  0.562   Deviance explained = 56.7%</span></span>
<span><span class="co">#&gt; fREML = -13623  Scale est. = 0.0012706  n = 4734</span></span></code></pre></div>
<p>Examining the summary of the resulting GAM fit object shows us that
the <code>k = 16</code> is sufficiently large to describe the spatial
variation of tract profile data. In addition, we see that there is a
statistically significant effect of group (with a p-value of 0.0244) and
no statistically significant effect of age (p = 0.3483).</p>
<p>Running the same analysis on the data from SLF, we see that there is
no significant difference between the groups in this tract, indicating
that the effect observed in CST is rather specific to this tract.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slf_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tractable_single_tract.html">tractable_single_tract</a></span><span class="op">(</span></span>
<span>  df         <span class="op">=</span> <span class="va">df_sarica</span>,</span>
<span>  tract      <span class="op">=</span> <span class="st">"Right SLF"</span>,</span>
<span>  target     <span class="op">=</span> <span class="st">"fa"</span>,</span>
<span>  regressors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"group"</span><span class="op">)</span>,</span>
<span>  node_group <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  k          <span class="op">=</span> <span class="st">"auto"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">slf_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">slf_fit</span><span class="op">)</span></span>
<span><span class="va">slf_summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: gaussian </span></span>
<span><span class="co">#&gt; Link function: identity </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; fa ~ age + group + s(nodeID, by = group, bs = "fs", k = 9) + </span></span>
<span><span class="co">#&gt;     s(subjectID, bs = "re")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parametric coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 0.4126030  0.0249891   16.51   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; age         0.0000153  0.0004033    0.04     0.97    </span></span>
<span><span class="co">#&gt; groupCTRL   0.0063865  0.0073081    0.87     0.38    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Approximate significance of smooth terms:</span></span>
<span><span class="co">#&gt;                         edf Ref.df   F p-value    </span></span>
<span><span class="co">#&gt; s(nodeID):groupALS  7.98115      8 468  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(nodeID):groupCTRL 7.98013      8 493  &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; s(subjectID)        0.00012     45   0       1    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; R-sq.(adj) =  0.624   Deviance explained = 62.5%</span></span>
<span><span class="co">#&gt; fREML = -15118  Scale est. = 0.0015159  n = 4785</span></span></code></pre></div>
<p>This is in line with other work that we have conducted with this
dataset using other methods <span class="citation">(Richie-Halford et
al. 2021)</span>.</p>
<p>If you are interested in exploring the ALS dataset even more, you can
also see this data in an AFQ-Browser <a href="yeatmanlab.github.io/Sarica_2017/">here</a> <span class="citation">(Yeatman et al. 2018)</span>.</p>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Richie-Halford2021SGL" class="csl-entry">
Richie-Halford, Adam, Jason D Yeatman, Noah Simon, and Ariel Rokem.
2021. <span>“Multidimensional Analysis and Detection of Informative
Features in Human Brain White Matter.”</span> <em>PLoS Comput.
Biol.</em> 17 (6): e1009136.
</div>
<div id="ref-Sarica2017" class="csl-entry">
Sarica, Alessia, Antonio Cerasa, Paola Valentino, Jason Yeatman, Maria
Trotta, Stefania Barone, Alfredo Granata, et al. 2017. <span>“The
Corticospinal Tract Profile in Amyotrophic Lateral Sclerosis.”</span>
<em>Hum. Brain Mapp.</em> 38 (2): 727–39.
</div>
<div id="ref-Yeatman2018AFQB" class="csl-entry">
Yeatman, Jason D, Adam Richie-Halford, Josh K Smith, Anisha Keshavan,
and Ariel Rokem. 2018. <span>“A Browser-Based Tool for Visualization and
Analysis of Diffusion <span>MRI</span> Data.”</span> <em>Nat.
Commun.</em> 9 (1): 940.
</div>
</div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adam Richie-Halford, Kelly Chang, Teresa Gomez, McKenzie Hagen, Ethan Roy, Ariel Rokem.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
